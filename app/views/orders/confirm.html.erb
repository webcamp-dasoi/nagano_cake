<div class="container">
	<h3>注文情報確認</h3>
	<div class="row">
		<div class="col-xs-7">
			<table class="table table-bordered">
				<thead>
					<tr class="info">
						<th>商品名</th>
						<th>単価(税込み)</th>
						<th>数量</th>
						<th>小計</th>
					</tr>
				</thead>
				<tbody>
					<% @end_user.cart_products.each do |cart_product| %>
						<tr>
							<td><%= attachment_image_tag(cart_product.product, :image, :fill, 50, 50) %>
								<%= cart_product.product.name %>
							</td>
							<td><%= cart_product.product.non_tax_price * 1.1 %></td>
							<td><%= cart_product.quantity %></td>
							<td>
								<%= cart_product.product.non_tax_price * cart_product.quantity * 1.1 %>
							</td>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>

		<div class="col-xs-5">
			<table class="table table-bordered">
				<tr>
					<td>送料</td>
					<td><%= @shipping_cost %></td>
				</tr>
				<tr>
					<td>商品合計</td>
					<td><%= @end_user.cart_products.to_a.sum { |cart_product| cart_product.product.non_tax_price * cart_product.quantity } * 1.1  %></td>
				</tr>
				<tr>
					<td>請求金額</td>
					<td>
						<%= @end_user.cart_products.to_a.sum { |cart_product| cart_product.product.non_tax_price * cart_product.quantity } * 1.1 + @shipping_cost %>
					</td>
				</tr>
			</table>
		</div>

		<div class="row">
			<table>
				<tr>
					<th><h3>支払い方法</h3></th>
					<td></td>
					<td><%= @order.payment_method %></td>
				</tr>
				<tr>
					<th><h3>お届け先</h3></th>
					<td></td>
					<% if params[:order][:shipping] == '0' %>
						<td>
							<%= current_end_user.post_number %> <%= current_end_user.address %>
							<br><%= current_end_user.last_name %> <%= current_end_user.first_name %>
						</td>
					<% elsif params[:order][:shipping] == '1' %>
						<td>
							<%= @address.post_number %> <%= @address.address %>
							<br><%= @address.name %>
						</td>
					<% elsif params[:order][:shipping] == '2' %>
						<td>
							<%= @order.shipping_post_number %> <%= @order.shipping_address %>
							<br><%= @order.shipping_name %>
						</td>

					<% end %>
				</tr>
			</table>
		</div>
		<div class="text-center">
			<%= form_with model: @order, local: true do |f| %>
				<% if params[:order][:shipping] == '0' %>
					<%= f.hidden_field :payment_method %>
					<%= f.hidden_field :shipping_name, value: current_end_user.last_name %>
					<%= f.hidden_field :shipping_post_number, value: current_end_user.post_number %>
					<%= f.hidden_field :shipping_address, value: current_end_user.address %>
				<% elsif params[:order][:shipping] == '1' %>
					<%= f.hidden_field :payment_method %>
					<%= f.hidden_field :shipping_name, value: @address.name %>
					<%= f.hidden_field :shipping_post_number, value: @address.post_number %>
					<%= f.hidden_field :shipping_address, value: @address.address %>
				<% elsif params[:order][:shipping] == '2'  %>
					<%= f.hidden_field :payment_method %>
					<%= f.hidden_field :shipping_name %>
					<%= f.hidden_field :shipping_post_number %>
					<%= f.hidden_field :shipping_address %>
				<% end %>
					<%= f.hidden_field :shipping_cost, value: @shipping_cost %>
					<%= f.hidden_field :total_price, value: @end_user.cart_products.to_a.sum { |cart_product| cart_product.product.non_tax_price * cart_product.quantity } * 1.1 + @shipping_cost %>
					<% @end_user.cart_products.each do |cart_product| %>
						<%= f.fields_for :order_product, cart_product do |order_product|%>
							<%= order_product.hidden_field :quantity, value: cart_product.quantity %>
							<%= order_product.hidden_field :tax_price, value: cart_product.product.non_tax_price %>
							<%= order_product.hidden_field :product_id, value: cart_product.product_id %>
							<%= order_product.hidden_field :order_id, value: @end_user.orders.ids %>
						<% end %>
					<% end %>
					<%= f.submit "購入を確定する", class: "btn btn-success btn-lg" %>
			<% end %>
		</div>
	</div>
</div>