<div class="container">
	<h3>注文履歴詳細</h3>
	<div class="row">
		<%= form_with model: [:owner, @order], local: true do |f| %>
			<table>
				<tr>
					<th>購入者</th>
					<td>
						<%= link_to @order.end_user.name, owner_end_user_path(@end_user) %>
					</td>
				</tr>
				<tr>
					<th>配送先</th>
					<td>
						〒<%= @order.shipping_post_number %><%= @order.shipping_address %>
						<%= @order.shipping_name %>
					</td>
				</tr>
				<tr>
					<th>
						<th>支払い方法</th>
						<td><%= @order.payment_method %></td>
					</th>
				</tr>
				<tr>
					<th>注文ステータス</th>
					<td>
						<%= f.select :order_status, {"入金待ち": 0, "入金確認": 1, "製作中": 2, "発送準備中": 3, "発送済み": 4} %>
						<%= f.submit "更新", class= "btn btn-primary btn-sm" %>
					</td>
				</tr>
			</table>
		<% end %>

		<%= f.fields_for [:owner, @order_product] do |i| %>
			<table class="table">
				<thead>
					<tr>
						<th>商品名</th>
						<th>単価（税込み)</th>
						<th>数量</th>
						<th>小計</th>
						<th>製作ステータス</th>
					</tr>
				</thead>
				<tbody>
					<% @order_products.each do |order_product| %>
						<tr>
							<td><%= order_product.product.name %></td>
							<td>
								<%= ( order_product.product.non_tax_price * 1.1 ).floor %>
						    </td>
						    <td><%= order_product.quantity %></td>
						    <td>
						    	<%= ( order_product.product.non_tax_price * order_product.quantity * 1.1 ).floor %>
						    </td>
						    <td>
						    	<%= i.select :producing_status, {"着手不可": 0, "製作待ち": 1, "製作中": 2, "製作完了": 3} %>
						    	<%= i.submit "更新", class= "btn btn-primary btn-sm" %>
						    </td>
						</tr>
						<% end %>
					<% end %>
				</tbody>
			</table>
		<% end %>

		<table>
			<tr>
				<th>商品合計</th>
				<td>
					<%= ( @order.order_products.to_a.sum { |order_product| order_product.product.non_tax_price * order_product.quantity } * 1.1 ).floor %>円
				</td>
			</tr>
			<tr>
				<th>送料</th>
				<td>800円</td>
			</tr>
			<tr>
				<th>請求金額合計</th>
				<th>
					<%= ( @order.order_products.to_a.sum { |order_product| order_product.product.non_tax_price * order_product.quantity } * 1.1 + 800 ).floor %>円
				</th>
			</tr>
		</table>
